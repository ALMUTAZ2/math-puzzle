
  <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لغز رياضي</title>
    <script src="https://cdn.jsdelivr.net/npm/emailjs-com@2.4.1/dist/email.min.js"></script>
    <script src="https://api.ipify.org?format=jsonp&callback=getIP" async></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin-top: 50px;
        }
        .container {
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #f9f9f9;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        input[type="text"] {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }
        button {
            padding: 10px 20px;
            background-color: #007BFF;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
        .result {
            margin-top: 20px;
            font-size: 18px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>حل اللغز</h1>
        <p>أدخل اسمك أولاً ثم أجب عن اللغز:</p>
        <input type="text" id="name" placeholder="أدخل اسمك هنا">
        <p>حل اللغز التالي:</p>
        <ul style="text-align: left;">
            <li>1 + 3 = 5</li>
            <li>2 + 4 = 14</li>
            <li>3 + 5 = 30</li>
            <li>4 + 6 = 54</li>
            <li>5 + 7 = ❓</li>
        </ul>
        <p><strong>ما هي الإجابة؟</strong></p>
        <input type="text" id="answer" placeholder="أدخل الإجابة هنا">
        <button onclick="checkAnswer()">تحقق من الإجابة</button>
        <div class="result" id="result"></div>
    </div>

    <script>
        // تهيئة EmailJS باستخدام المفتاح العام
        emailjs.init("Non4_CdtCimLox-Ow");

        // قائمة لتخزين أسماء المشاركين ونتائجهم
        const participants = [];
        let userIP = ""; // لتخزين عنوان IP الخاص بالمستخدم

        // الحصول على عنوان IP باستخدام ipify
        function getIP(data) {
            userIP = data.ip;
        }

        function checkAnswer() {
            const name = document.getElementById("name").value.trim(); // اسم المستخدم
            const userAnswer = parseInt(document.getElementById("answer").value); // الإجابة
            const resultDiv = document.getElementById("result");
            const correctAnswer = 80; // الإجابة الصحيحة

            // التحقق إذا كان الاسم أو الإجابة فارغين
            if (!name) {
                resultDiv.textContent = "يرجى إدخال اسمك!";
                resultDiv.style.color = "red";
                return;
            }
            if (isNaN(userAnswer)) {
                resultDiv.textContent = "يرجى إدخال الإجابة!";
                resultDiv.style.color = "red";
                return;
            }

            // التحقق مما إذا كان المستخدم قد قام بالاشتراك مسبقًا
            const subscribedIPs = JSON.parse(localStorage.getItem("subscribedIPs")) || [];
            if (subscribedIPs.includes(userIP)) {
                resultDiv.textContent = "لقد قمت بالاشتراك مسبقًا!";
                resultDiv.style.color = "red";
                return;
            }

            // التحقق من الإجابة
            let resultMessage;
            if (userAnswer === correctAnswer) {
                resultMessage = "إجابة صحيحة!";
                resultDiv.style.color = "green";
            } else {
                resultMessage = "إجابة خاطئة. حاول مرة أخرى.";
                resultDiv.style.color = "red";
            }

            // عرض النتيجة للمستخدم
            resultDiv.textContent = `${name}, ${resultMessage}`;

            // إضافة اسم المستخدم والنتيجة إلى القائمة
            participants.push({ name: name, result: resultMessage });

            // حفظ عنوان IP في التخزين المحلي
            subscribedIPs.push(userIP);
            localStorage.setItem("subscribedIPs", JSON.stringify(subscribedIPs));

            // إرسال السجل بالبريد الإلكتروني
            sendEmail();
        }

        function sendEmail() {
            const emailContent = participants.map((participant, index) => {
                return `${index + 1}. ${participant.name}: ${participant.result}`;
            }).join("\n");

            const templateParams = {
                to_email: "almutazabutaleb@gmail.com", // بريدك الإلكتروني
                message: emailContent
            };

            emailjs.send("service_tzz1ey7", "template_vqni18r", templateParams)
                .then(function(response) {
                    console.log("Email sent successfully!", response.status, response.text);
                }, function(error) {
                    console.error("Failed to send email.", error);
                });
        }
    </script>
</body>
</html>
